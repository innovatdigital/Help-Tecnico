<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Help Técnico | Nova empresa</title>
  <link rel="shortcut icon" href="/img/login/icon.png" type="image/x-icon">
  <!-- Custom styles -->
  <link rel="stylesheet" href="/css/platform/style.css">
  <link rel="stylesheet" href="/css/platform/notify.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.8.12/tailwind-experimental.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>

<body>
  <%- include('../partials/sidebar-platform', {isAdmin: isAdmin}) %>

  <div class="lg:pl-70">
    <%- include('../partials/nav-platform', {isAdmin: isAdmin, title: "Adicionar novo fornecedor", notifications: notifications, photo: photo, name_user: name_user}) %>

    <main class="py-8 px-12 fade-in">
      <div class="alert mt-10" style="display: none;"><div style="display: flex;" class="alert-text"></div></div>
      <div class="error" style="display: none;"><div style="display: flex;" class="error-text"></div></div>

      <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-x-6">
        <div class="bg-white rounded-xl shadow-lg border p-4 px-5 col-span-3">
          <div class="col-span-full flex items-center gap-x-6 mt-4">
            <svg width="74" height="73" viewBox="0 0 74 73" fill="none" xmlns="http://www.w3.org/2000/svg">
              <ellipse cx="37" cy="36.5" rx="37" ry="36.5" fill="#0EA5E9"/>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M37 38.25C37.6904 38.25 38.25 38.8096 38.25 39.5V52C38.25 52.6904 37.6904 53.25 37 53.25C36.3096 53.25 35.75 52.6904 35.75 52V39.5C35.75 38.8096 36.3096 38.25 37 38.25ZM44.5 38.25C45.1904 38.25 45.75 38.8096 45.75 39.5C45.75 43.9951 47.921 48.124 51.5092 50.6911C52.0707 51.0928 52.2002 51.8736 51.7985 52.4351C51.3968 52.9965 50.6161 53.1261 50.0546 52.7244C45.8171 49.6928 43.25 44.8105 43.25 39.5C43.25 38.8096 43.8096 38.25 44.5 38.25ZM29.5 38.25C30.1904 38.25 30.75 38.8096 30.75 39.5C30.75 44.8044 28.1889 49.6817 23.9595 52.7143C23.3984 53.1166 22.6175 52.9879 22.2152 52.4269C21.8129 51.8658 21.9416 51.0849 22.5027 50.6826C26.0841 48.1147 28.25 43.9899 28.25 39.5C28.25 38.8096 28.8096 38.25 29.5 38.25ZM52 19.5C54.7614 19.5 57 21.7386 57 24.5V32C57 34.7614 54.7614 37 52 37H22C19.2386 37 17 34.7614 17 32V24.5C17 21.7386 19.2386 19.5 22 19.5H52ZM50.75 29.5H23.25C22.5596 29.5 22 30.0596 22 30.75C22 31.4404 22.5596 32 23.25 32H50.75C51.4404 32 52 31.4404 52 30.75C52 30.0596 51.4404 29.5 50.75 29.5Z" fill="white"/>
            </svg>                                            
                                      
            <div class="items-center mt-2">
              <label style="cursor: pointer;" for="picture" class="rounded-md px-3 py-2 text-sm font-semibold border-blue color-blue shadow-sm inter">Inserir foto</label>
              <p class="mt-4 text-xs leading-5 text-gray-600 inter">JPG, GIF or PNG. 1MB max.</p>
              <input type="file" id="picture" class="hidden" name="picture">
            </div>
          </div>

          <div class="grid grid-cols-2 mt-12 gap-x-4">
            <div>
              <label for="name" class="block text-md font-medium leading-6 text-gray-900 inter font-semibold">Nome da empresa/fornecedor</label>
              <div class="relative mt-2 rounded-md shadow-sm">
                <input type="text" name="name" id="name" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Insira o nome">
              </div>
            </div>

            <div>
              <label for="email" class="block text-md font-medium leading-6 text-gray-900 inter font-semibold">Email</label>
              <div class="relative mt-2 rounded-md shadow-sm">
                <input type="text" name="email" id="email" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Insira o email">
              </div>
            </div>
          </div>

          <div class="grid grid-cols-3 mt-12 gap-x-4">
            <div>
              <label for="address" class="block text-md font-medium leading-6 text-gray-900 inter font-semibold">Endereço</label>
              <div class="relative mt-2 rounded-md shadow-sm">
                <input type="text" name="address" id="address" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Insira o endereço">
              </div>
            </div>

            <div>
              <label for="cep" class="block text-md font-medium leading-6 text-gray-900 inter font-semibold">CEP</label>
              <div class="relative mt-2 rounded-md shadow-sm">
                <input type="text" name="cep" id="cep" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Insira o CEP">
              </div>
            </div>

            <div>
              <label for="city" class="block text-md font-medium leading-6 text-gray-900 inter font-semibold">Cidade</label>
              <div class="relative mt-2 rounded-md shadow-sm">
                <input type="text" name="city" id="city" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Insira a cidade">
              </div>
            </div>
          </div>

          <div class="grid grid-cols-3 mt-12 gap-x-4">
            <div>
              <label for="landline" class="block text-md font-medium leading-6 text-gray-900 inter font-semibold">Telefone (Fixo)</label>
              <div class="relative mt-2 rounded-md shadow-sm">
                <input type="number" name="landline" id="landline" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Insira o telefone fixo">
              </div>
            </div>

            <div>
              <label for="phone" class="block text-md font-medium leading-6 text-gray-900 inter font-semibold">Telefone (Celular)</label>
              <div class="relative mt-2 rounded-md shadow-sm">
                <input type="number" name="phone" id="phone" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Insira o celular">
              </div>
            </div>

            <div>
              <label for="contactName" class="block text-md font-medium leading-6 text-gray-900 inter font-semibold">Nome do contato</label>
              <div class="relative mt-2 rounded-md shadow-sm">
                <input type="text" name="contactName" id="contactName" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Insira o nome do contato">
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 mt-12 gap-x-4">
            <div>
              <label class="block text-md font-medium leading-6 text-gray-900 inter font-semibold">O que ele fornece?</label>
              <div id="items">
                <div class="relative mt-2 rounded-md shadow-sm item-div">
                  <input type="text" id="item-content" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Exemplo: Peça X para ar-condicionado split">
                </div>
              </div>
            </div>

            <div style="cursor: pointer;" class="flex mt-6" id="newItem">          
              <div class="relative flex items-center">
                <div class="flex h-6 items-center">
                  <svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_236_21)">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.5 15.5C11.6421 15.5 15 12.1421 15 8C15 3.85786 11.6421 0.5 7.5 0.5C3.35786 0.5 0 3.85786 0 8C0 12.1421 3.35786 15.5 7.5 15.5ZM6.80429 7.48215V5.05966H8.67095V7.48215H11.0888V9.34881H8.67095V11.7667H6.80429V9.34881H4.38179V7.48215H6.80429Z" fill="#239CFF"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_236_21">
                    <rect width="15" height="16" fill="white"/>
                    </clipPath>
                    </defs>
                  </svg>                                                   
                </div>
                <div class="ml-3 leading-6">
                  <p class="block text-sm font-semibold leading-6 text-gray-900 nunito">Adicionar campo</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg border p-4 px-5 col-span-1">
          <div class="space-y-4">
            <button type="button" onclick="newSupplier()" style="background-color: #00AB55;" class="w-full inline-flex justify-center items-center gap-x-1.5 rounded-md px-3 py-3 text-sm font-semibold text-white nunito shadow-sm">
              <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_156_9768)">
                <path d="M3.46649 17.1132C4.68687 18.3337 6.65105 18.3337 10.5794 18.3337C14.5078 18.3337 16.472 18.3337 17.6923 17.1132C18.9128 15.8929 18.9128 13.9287 18.9128 10.0003C18.9128 9.71574 18.9128 9.57349 18.9001 9.42883C18.8413 8.75441 18.5678 8.09413 18.1325 7.57561C18.0391 7.46438 17.9361 7.3613 17.7299 7.15514L13.4246 2.84986C13.2184 2.64371 13.1153 2.54062 13.0042 2.44725C12.4856 2.01199 11.8253 1.7385 11.1509 1.67962C11.0063 1.66699 10.864 1.66699 10.5794 1.66699C6.65105 1.66699 4.68687 1.66699 3.46649 2.88738C2.24609 4.10777 2.24609 6.07195 2.24609 10.0003C2.24609 13.9287 2.24609 15.8929 3.46649 17.1132Z" stroke="white" stroke-width="1.25"/>
                <path d="M14.7435 18.3337V17.5003C14.7435 15.929 14.7435 15.1433 14.2553 14.6552C13.7672 14.167 12.9815 14.167 11.4102 14.167H9.74349C8.17214 14.167 7.38646 14.167 6.89831 14.6552C6.41016 15.1433 6.41016 15.929 6.41016 17.5003V18.3337" stroke="white" stroke-width="1.25"/>
                <path opacity="0.5" d="M6.41016 6.66699H11.4102" stroke="white" stroke-width="1.25" stroke-linecap="round"/>
                </g>
                <defs>
                <clipPath id="clip0_156_9768">
                <rect width="20" height="20" fill="white" transform="translate(0.578125)"/>
                </clipPath>
                </defs>
              </svg>                
              Salvar
            </button>

            <button type="button" style="background-color: #2196F3;" class="w-full inline-flex justify-center items-center gap-x-1.5 rounded-md px-3 py-3 text-sm font-semibold text-white nunito shadow-sm">
              <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_156_9775)">
                <path d="M15.3833 15.4046L17.9922 7.57843C19.0324 4.45761 19.5526 2.89719 18.7289 2.07351C17.9052 1.24982 16.3447 1.76996 13.2237 2.81023L5.44772 5.40214C3.71287 5.98041 2.84544 6.26953 2.58215 6.90563C2.52026 7.05513 2.48285 7.21363 2.47134 7.37502C2.42236 8.0617 3.0689 8.70824 4.36198 10.0012L4.59751 10.2367C4.80976 10.449 4.91587 10.5552 4.9961 10.6732C5.15432 10.9062 5.24413 11.1789 5.25536 11.4602C5.26105 11.603 5.23877 11.7514 5.19422 12.0482C5.03115 13.1347 4.94961 13.6779 5.04566 14.0959C5.23712 14.9292 5.88207 15.5832 6.71256 15.7864C7.12921 15.8883 7.67355 15.8145 8.76225 15.6667L8.82177 15.6587C9.12867 15.617 9.28216 15.5962 9.4295 15.6051C9.69691 15.6212 9.95525 15.7083 10.1779 15.8574C10.3005 15.9396 10.41 16.0491 10.629 16.2681L10.8384 16.4774C12.097 17.736 12.7262 18.3652 13.3938 18.3324C13.5778 18.3234 13.7587 18.2807 13.9273 18.2065C14.5391 17.9373 14.8205 17.0931 15.3833 15.4046Z" stroke="white" stroke-width="1.25"/>
                <path opacity="0.5" d="M5.80078 15L18.3008 2.5" stroke="white" stroke-width="1.25" stroke-linecap="round"/>
                </g>
                <defs>
                <clipPath id="clip0_156_9775">
                <rect width="20" height="20" fill="white" transform="translate(0.800781)"/>
                </clipPath>
                </defs>
              </svg>                                                
              Enviar por email
            </button>
          </div>

          <div class="mt-8">
            <h2 class="text-sm nunito font-semibold">Observações internas</h2>
            <textarea class="w-full rounded-lg border-blue text-sm mt-2 nunito p-2" name="comments" id="comments" cols="4" rows="6"></textarea>
          </div>
        </div>
      </div>
    </main>
  </div>
</body>

<script>
  const divItems = document.querySelector("#items")
  const newItemButton = document.querySelector("#newItem")

  function newItem() {
    var chars = 'abcdefghijklmnopqrstuvwxyz';
    var id = '';

    for (var i = 0; i < chars.length; i++) {
      var random = Math.floor(Math.random() * chars.length);
      id += chars.charAt(random);
    }

    const html = `
      <div class="w-full flex items-center mt-2" id="${id}">
        <div class="relative mt-2 rounded-md shadow-sm item-div">
          <input type="text" id="item-content" class="block w-full rounded-lg inter py-1.5 mt-2 pl-2 text-gray-900 ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6 border-blue-1" placeholder="Exemplo: Peça X para ar-condicionado split">
        </div>

        <button onclick="deleteItem(${id})" class="ml-2 mr-1">
          <svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_236_23)">
            <mask id="mask0_236_23" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="18">
            <path d="M16 0H0V18H16V0Z" fill="white"/>
            </mask>
            <g mask="url(#mask0_236_23)">
            <path d="M14.125 4.625L13.3661 15.2497C13.3007 16.1655 12.5387 16.875 11.6205 16.875H4.37946C3.46134 16.875 2.69932 16.1655 2.63391 15.2497L1.875 4.625M6.25 8.125V13.375M9.75 8.125V13.375M10.625 4.625V2C10.625 1.51675 10.2332 1.125 9.75 1.125H6.25C5.76675 1.125 5.375 1.51675 5.375 2V4.625M1 4.625H15" stroke="#239CFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </g>
            </g>
            <defs>
            <clipPath id="clip0_236_23">
            <rect width="16" height="18" fill="white"/>
            </clipPath>
            </defs>
          </svg>
        </button>
      </div>
    `;

    divItems.insertAdjacentHTML("beforeend", html);
  }

  function deleteItem(id) {
    id.remove()
  }

  newItemButton.addEventListener("click", function() {
    newItem()
  })

  function alertMessage(type, content) {
    if (type == 'error') {
      const divMessage = document.querySelector(".error");
      divMessage.style.display = "flex";
      divMessage.innerHTML = "";
      const message = document.createElement("p");
      const img = document.createElement("img");
      img.width = "28"
      img.height = "28"
      img.src = "/img/platform/notify-error.png"
      message.classList.add("message-notify");
      message.innerText = content;
      divMessage.appendChild(img);
      divMessage.appendChild(message);

      setTimeout(() => {
        divMessage.style = "animation: slideoff 2s;"
        setTimeout(() => {
          divMessage.style = "display: none"
        }, 800)
      }, 2000);
    } else if (type == "success") {
      const divMessage = document.querySelector(".alert");
      divMessage.style.display = "flex";
      divMessage.innerHTML = "";
      const message = document.createElement("p");
      const img = document.createElement("img");
      img.width = "28"
      img.height = "28"
      img.src = "/img/platform/notify-success.png"
      message.classList.add("message-notify");
      message.innerText = content;
      divMessage.appendChild(img);
      divMessage.appendChild(message);

      setTimeout(() => {
        divMessage.style = "animation: slideoff 2s;"
        setTimeout(() => {
          divMessage.style = "display: none"
        }, 800)
      }, 2000);
    }
  }

  function newSupplier() {
    const name = document.querySelector("#name")
    const email = document.querySelector("#email")
    const address = document.querySelector("#address")
    const cep = document.querySelector("#cep")
    const city = document.querySelector("#city")
    const landline = document.querySelector("#landline")
    const phone = document.querySelector("#phone")
    const contactName = document.querySelector("#contactName")
    const comments = document.querySelector("#comments")
    const items = document.getElementsByClassName('item-div')
    const contents = []

    for (var i = 0; i < items.length; i++) {
      const item = items[i].querySelector("#item-content");

      if (item.value.length < 1) {
        alertMessage("error", "Nenhum item adicionado")
        return
      }
      
      contents.push(item.value)
    }

    if (contents.length < 1) {
      alertMessage("error", "Adicione pelo menos um item")
      return
    }

    if (name.value.length == 0) {
      name.style = "border: 1px solid #e00d0d !important"
      return
    }

    if (address.value.length == 0) {
      address.style.border = "1px solid #e00d0d";
      return
    }

    if (cep.value.length == 0) {
      cep.style.border = "1px solid #e00d0d";
      return
    }

    if (city.value.length == 0) {
      city.style.border = "1px solid #e00d0d";
      return
    }

    if (landline.value.length == 0) {
      landline.style.border = "1px solid #e00d0d";
      return
    }

    if (phone.value.length == 0) {
      phone.style.border = "1px solid #e00d0d";
      return
    }

    fetch('/admin/new-supplier/save', {
      method: 'POST',
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({name: name.value, email: email.value, address: address.value, cep: cep.value, city: city.value, landline: landline.value, phone: phone.value, contactName: contactName.value, type: contents, comments: comments.value})
    })
    .then((response) => {
      if (response.ok) {
        alertMessage("success", "Fornecedor adicionado com sucesso.")
      } else {
        alertMessage("error", "Erro ao adicionar fornecedor")
      }
    })
    .catch((error) => {
      alertMessage("error", "Tente novamente mais tarde")
    })
  }
</script>
</html>