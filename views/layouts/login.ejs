<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Rocket Sell">
    <meta name="generator" content="Disparos">
    <title>pluBee Login</title>
    <link rel="shortcut icon" href="/img/site/plubee-icon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.8.12/tailwind-experimental.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/main/style.css">
  </head>

<body>
  <%- include('../partials/nav-site') %>

  <div id="login" class="flex min-h-full items-center justify-center px-4 py-20 sm:px-6 lg:px-8">
    <div class="alert" style="display: none;"><div style="display: flex;" class="alert-text"></div></div>
    <div class="error" style="display: none;"><div style="display: flex;" class="error-text"></div></div>

    <div class="w-full max-w-sm space-y-10">
      <div>
        <img class="mx-auto h-24 w-auto" src="/img/site/nav.png" alt="plubee">
        <h2 class="mt-10 text-center text-2xl font-bold leading-9 tracking-tight text-gray-900 made-tommy">Realize o login na sua conta</h2>
      </div>
      <div class="space-y-6">
        <div class="relative -space-y-px rounded-md shadow-sm">
          <div class="pointer-events-none absolute inset-0 z-10 rounded-md ring-1 ring-inset ring-gray-300"></div>
          <div>
            <label for="email-address" class="sr-only">Endereço de email</label>
            <input id="inputEmail" name="email" type="email" autocomplete="email" required class="relative block w-full rounded-t-lg border py-2 text-gray-900 ring-1 ring-inset ring-gray-100 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 pl-2 made-tommy" placeholder="Endereço de email">
          </div>
          <div>
            <label for="password" class="sr-only">Senha</label>
            <input id="inputPassword" name="password" type="password" autocomplete="current-password" required class="relative block w-full rounded-b-lg border py-2 text-gray-900 ring-1 ring-inset ring-gray-100 placeholder:text-gray-400 focus:z-10 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 pl-2 made-tommy" placeholder="Sua senha">
          </div>
        </div>
  
        <div class="flex items-center justify-center">
          <div class="text-sm leading-6">
            <a href="#" class="font-semibold color-purple">Esqueceu a senha?</a>
          </div>
        </div>
  
        <div>
          <button type="submit" class="flex w-full justify-center rounded-lg px-3 py-2.5 text-sm font-semibold leading-6 text-white bg-purple made-tommy btn-login">Entrar</button>
        </div>
      </div>
  
      <p class="text-center text-sm leading-6 text-gray-500">
        Não é um membro?
        <a href="/#plans" class="font-semibold color-purple">Adquira um plano e obtenha 7 dias de garantia!</a>
      </p>
    </div>
  </div>

  <%- include('../partials/footer-site') %>
</body>
</html>

<script>
  document.addEventListener('keypress', function(e) {
    if (e.which == 13) {
      login();
    }
  }, false);

  if (window.location.hash && window.location.hash === '#_=_') {
    window.location.hash = '';
    location.href = "/platform/accounts"
  }

  function alert_message(type, content) {
    if (type == 'error') {
      const divMessage = document.querySelector(".error");
      divMessage.style.display = "flex";
      divMessage.innerHTML = "";
      const message = document.createElement("p");
      const img = document.createElement("img");
      img.width = "28"
      img.height = "28"
      img.src = "/img/admin/Bulk/error.png"
      message.classList.add("message-notify");
      message.innerText = content;
      divMessage.appendChild(img);
      divMessage.appendChild(message);

      setTimeout(() => {
        divMessage.style = "animation: slideoff 2s;"
        setTimeout(() => {
          divMessage.style = "display: none"
        }, 800)
      }, 2000);
    } else if (type == "success") {
      const divMessage = document.querySelector(".alert");
      divMessage.style.display = "flex";
      divMessage.innerHTML = "";
      const message = document.createElement("p");
      const img = document.createElement("img");
      img.width = "28"
      img.height = "28"
      img.src = "/img/admin/Bulk/checked.png"
      message.classList.add("message-notify");
      message.innerText = content;
      divMessage.appendChild(img);
      divMessage.appendChild(message);

      setTimeout(() => {
        divMessage.style = "animation: slideoff 2s;"
        setTimeout(() => {
          divMessage.style = "display: none"
        }, 800)
      }, 2000);
    }
  }

  const btn = document.querySelector('.btn-login')

  btn.addEventListener("click", function() {
    login()
  })

  function login() {
    const email = document.querySelector("#inputEmail").value;
    const password = document.querySelector("#inputPassword").value;

    if (email.length == 0) { 
      email.style = "border: 2px solid red;"
    }

    if (password.length == 0) {
      password.style = "border: 2px solid red;"
    }

    fetch("/login/auth", {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: email, password: password })
    })
    .then((response) => {
      if (response.ok) {
        return response.json();
      }
      throw new Error("Erro ao processar a resposta da requisição");
    })
    .then((data) => {
      if (data.auth) {
        window.location.href = "https://plubee.net/platform/"
      } else {
        alert_message("error", "Nenhum usuário no sistema")
      }
    })
    .catch((error) => {
      console.log(error)
    })
  }
</script>